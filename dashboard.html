<!doctype html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Rekod Inovasi</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js"></script>
  <script src="app.js"></script>

  <style>
    @media print {
      body * { visibility: hidden; }
      #reportArea, #reportArea * { visibility: visible; }
      #reportArea { position: absolute; left: 0; top: 0; width: 100%; }
    }
  </style>
</head>

<body class="min-h-screen bg-[#fbfbfe] text-slate-800">
  <div class="mx-auto max-w-6xl px-6 py-10">
    <!-- Header -->
    <div class="flex items-start justify-between gap-6">
      <div>
        <div class="text-3xl font-extrabold tracking-tight text-slate-900">Dashboard</div>
        <div class="mt-1 text-sm text-slate-600">
          Login: <span class="font-semibold" data-email>-</span>
          <span class="ml-2 inline-flex items-center rounded-full border border-indigo-200 bg-indigo-50 px-2 py-0.5 text-xs text-indigo-700" data-role>-</span>
        </div>
      </div>
      <button id="btnLogout" class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm hover:bg-slate-50">
        Logout
      </button>
    </div>

    <!-- Actions -->
    <div class="mt-6 flex flex-wrap gap-2">
      <button id="btnList" class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm hover:bg-slate-50">List My Innovations</button>
      <button id="btnReport" class="rounded-xl border border-indigo-200 bg-indigo-50 px-4 py-2 text-sm text-indigo-700 hover:bg-indigo-100">Generate Report 2026</button>
      <button id="btnPrint" class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm hover:bg-slate-50">Print / Save PDF (Report 2026)</button>
      <a href="./add-innovation.html" class="rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-2 text-sm text-emerald-800 hover:bg-emerald-100">+ Tambah Inovasi</a>
    </div>

    <!-- KPI -->
    <div class="mt-6 grid gap-3 md:grid-cols-4">
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="text-xs text-slate-500">Jumlah Inovasi</div>
        <div class="mt-1 text-3xl font-bold text-slate-900" data-kpi-total>0</div>
      </div>
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="text-xs text-slate-500">Bil. Tahun Terlibat</div>
        <div class="mt-1 text-3xl font-bold text-slate-900" data-kpi-years>0</div>
      </div>
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="text-xs text-slate-500">Status Aktif</div>
        <div class="mt-1 text-3xl font-bold text-slate-900" data-kpi-aktif>0</div>
      </div>
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="text-xs text-slate-500">MyIPO (Yes)</div>
        <div class="mt-1 text-3xl font-bold text-slate-900" data-kpi-myipo>0</div>
      </div>
    </div>

    <!-- Table -->
    <div class="mt-6 rounded-3xl border border-slate-200 bg-white shadow-sm overflow-hidden">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-100">
        <div class="text-base font-semibold text-slate-900">Senarai Inovasi Saya</div>
        <div class="text-sm text-slate-500" id="countText">—</div>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-slate-50 text-slate-600">
            <tr>
              <th class="px-4 py-3 text-left font-medium">Tajuk</th>
              <th class="px-4 py-3 text-left font-medium">Tahun</th>
              <th class="px-4 py-3 text-left font-medium">Kategori</th>
              <th class="px-4 py-3 text-left font-medium">Status</th>
              <th class="px-4 py-3 text-left font-medium">MyIPO</th>
              <th class="px-4 py-3 text-left font-medium">ID</th>
            </tr>
          </thead>
          <tbody id="tableBody" class="divide-y divide-slate-100"></tbody>
        </table>
      </div>

      <details class="border-t border-slate-100">
        <summary class="cursor-pointer px-5 py-3 text-sm text-slate-600">Debug output (kalau nak tengok JSON)</summary>
        <pre id="debugJson" class="px-5 pb-5 text-xs text-slate-600 overflow-x-auto"></pre>
      </details>
    </div>

    <!-- Report section (print-only container) -->
    <div id="reportArea" class="hidden mt-8"></div>

    <!-- Toast -->
    <div id="toast" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 rounded-2xl border px-4 py-3 shadow-sm">
      <div class="text-sm" data-toast-text>Toast</div>
    </div>

    <div class="mt-10 text-xs text-slate-400">© 2026 kurakurahijau.com</div>
  </div>

<script>
  applyThemeBase();
  if (!requireAuthOrRedirect()) {}

  qs("#btnLogout").onclick = () => { clearSession(); location.href = "./index.html"; };
  qs("#btnList").onclick = async () => { await loadInnovationsAndRender(); };
  qs("#btnReport").onclick = async () => {
    await generateReport2026();
    toast("Report ready (print dialog akan keluar)", "success");
  };
  qs("#btnPrint").onclick = async () => { await generateReport2026(); };

  // initial load
  loadInnovationsAndRender();
</script>
</body>
</html>
