<!doctype html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rekod Inovasi Jabatan</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js"></script>
  <script src="app.js"></script>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body class="min-h-screen bg-[#fbfbfe] text-slate-800">
  <div class="mx-auto max-w-5xl px-6 py-16">
    <div class="grid gap-10 md:grid-cols-2 items-center">
      <div>
        <div class="inline-flex items-center gap-2 rounded-full border border-indigo-200 bg-indigo-50 px-3 py-1 text-xs text-indigo-700">
          Corporate minimal • soft pastel
        </div>
        <h1 class="mt-4 text-4xl font-extrabold tracking-tight text-slate-900">Rekod Inovasi Jabatan</h1>
        <p class="mt-3 text-slate-600">
          Log masuk guna akaun rasmi <span class="font-semibold">@pms.edu.my</span>.
          Pengguna baru akan auto-daftar dalam sistem.
        </p>

        <div class="mt-6 flex flex-col gap-3">
          <div id="gbtn"></div>
          <p class="text-xs text-slate-500">
            Jika popup Google tak keluar, pastikan browser tak block third-party cookies / popups.
          </p>
        </div>

        <div class="mt-6 text-sm text-slate-600" id="status">Status: menunggu sign-in…</div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white p-8 shadow-sm">
        <div class="text-sm font-semibold text-slate-900">Apa yang boleh dibuat</div>
        <ul class="mt-3 space-y-2 text-sm text-slate-600">
          <li>• Simpan rekod inovasi (tajuk, kategori, status, MyIPO).</li>
          <li>• Dashboard ringkas (KPI + senarai rekod).</li>
          <li>• Generate & Print/Save PDF (Report 2026).</li>
        </ul>
        <div class="mt-6 rounded-2xl bg-[#fbfbfe] border border-slate-200 p-4 text-xs text-slate-500">
          Tip: role <b>admin</b> boleh kau set manual dalam sheet Users.
        </div>
      </div>
    </div>

    <div id="toast" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 rounded-2xl border px-4 py-3 shadow-sm">
      <div class="text-sm" data-toast-text>Toast</div>
    </div>

    <div class="mt-10 text-xs text-slate-400">© 2026 kurakurahijau.com</div>
  </div>

<script>
  applyThemeBase();

  // kalau dah login, terus pergi dashboard
  if (getToken() && getEmail()) location.href = "./dashboard.html";

  function onGoogleCredential(response) {
    const idToken = response.credential;
    qs("#status").textContent = "Status: signing in…";

    apiPost("loginGoogle", { idToken })
      .then(r => {
        if (!r.ok) throw new Error(r.error || "Login gagal");
        setSession(r.email, r.role, r.token);
        toast("Login berjaya", "success");
        location.href = "./dashboard.html";
      })
      .catch(err => {
        toast(String(err.message || err), "error");
        qs("#status").textContent = "Status: login gagal";
      });
  }

  window.onload = () => {
    google.accounts.id.initialize({
      client_id: window.APP_CONFIG.CLIENT_ID,
      callback: onGoogleCredential,
      hd: "pms.edu.my"
    });

    google.accounts.id.renderButton(
      document.getElementById("gbtn"),
      {
        theme: "outline",
        size: "large",
        width: 320,
        text: "signin_with",
        shape: "pill"
      }
    );
  };
</script>
</body>
</html>
